generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                   BigInt     @id @default(autoincrement())
  Name                 String
  Created_At           DateTime   @default(now())
  Max_User             Int
  Suspscription_package String
  Sub_end_time         DateTime

  users                User[]
  invites              Invite[]
  categories           Categories[]
  products             Products[]

  @@map("companies")
}

model User {
  id           BigInt     @id @default(autoincrement())
  Name         String
  Mail         String     @unique
  password     String
  is_confirm   Boolean    @default(false)
  is_SuperAdmin Boolean   @default(false)
  is_active    Boolean    @default(true)
  created_at   DateTime   @default(now())

  company_id   BigInt
  company      Company    @relation(fields: [company_id], references: [id])

  permissions  Users_Permissions[]
  confirmTokens ConfirmToken[]
  refreshTokens RefreshToken[]
  responsibleSteps ProductSteps[]

  @@map("users")
}

model Permissions {
  id     BigInt     @id @default(autoincrement())
  Name   String
  Type   String

  users  Users_Permissions[]

  @@map("permissions")
}

model Users_Permissions {
  id            BigInt      @id @default(autoincrement())
  User_id       BigInt
  Permission_id BigInt

  user          User        @relation(fields: [User_id], references: [id])
  permission    Permissions @relation(fields: [Permission_id], references: [id])

  @@map("users_permissions")
}

model ConfirmToken {
  id        BigInt   @id @default(autoincrement())
  user_id   BigInt
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user      User     @relation(fields: [user_id], references: [id])

  @@map("confirm_tokens")
}

model RefreshToken {
  id          BigInt   @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      BigInt
  tokenHash   String
  expiresAt   DateTime
  revoked     Boolean  @default(false)
  createdAt   DateTime @default(now())

  @@map("refresh_tokens")
}

model Invite {
  id           BigInt   @id @default(autoincrement())
  Company_id   BigInt
  mail         String
  is_confirm   Boolean  @default(false)
  created_at   DateTime @default(now())
  invite_token String   @unique
  expires_at   DateTime

  company      Company  @relation(fields: [Company_id], references: [id])

  @@map("invites")
}

model Categories {
  id          BigInt    @id @default(autoincrement())
  Name        String
  Description String?
  Company_id  BigInt
  
  company     Company   @relation(fields: [Company_id], references: [id])
  products    Products[]
  
  @@map("categories")
}

model Products {
  id          BigInt     @id @default(autoincrement())
  name        String
  description String?
  Category_id BigInt
  Company_id  BigInt
  
  category    Categories @relation(fields: [Category_id], references: [id])
  company     Company    @relation(fields: [Company_id], references: [id])
  steps       ProductSteps[]
  
  @@map("products")
}

model ProductSteps {
  id              BigInt   @id @default(autoincrement())
  Name            String
  Description     String?
  Product_id      BigInt
  Step_number     Int
  Responsible_User BigInt?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  product         Products @relation(fields: [Product_id], references: [id], onDelete: Cascade)
  responsible     User?    @relation(fields: [Responsible_User], references: [id])
  
  @@map("product_steps")
  @@unique([Product_id, Step_number])
}
